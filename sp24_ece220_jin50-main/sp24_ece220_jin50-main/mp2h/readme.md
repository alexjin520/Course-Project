# ECE 220 Honors Section
# MP2 Parallel Accumulator with shared total

In this MP you will implement a parallel accumulator that calculates the sum of all numbers within a set of given files. The difference between the first and MP and the second MP is where the result is stored. In MP1 the result is stored in an array of size NUM_THREADS, while in this MP there is only a single variable to store the result.

General guidelines: 
1. Do not change thread_info.h as this file is automatically generated and used for graph functionality
2. You can vary the number of threads used in acc.h
3. Do not change any of the python (.py) files

Usage:  

  1. generate 1,000,000 input data points separated in <number_of_threads> [1-99] files  
    
    $ python3 generate_data.py [number_of_threads]
    
  2. compile program
    
    $ gcc acc_serial.c -g -o acc_serial
    $ gcc acc_parallel.c -g -lpthread -o acc_parallel

  3. run test program

    $ ./acc_serial
    $ ./acc_parallel

  4. automatically recompile and run both versions of the accumulator, compares the output and speedup

    $ python3 benchmark.py

  5. make a graph of speedup vs number of threads used (requires matplotlib)

    $ python3 graph.py

Todos:  
1. Complete the pthread wrapper function parallel_acc_wrapper in acc.h  
2. Complete the sequential version of the accumulator in acc_serial.c  
3. Complete the parallel version of the accumulator in acc_parallel.c
4. Verify the two outputs for serial_output.txt and parallel_output.txt are the same.
5. In your report answer the following questions
    - If we don't use a mutex in acc.h to guard result, we could see that running `acc_parallel` multiple times could give you inconsistent results.Why?
    - Include console output from running `python benchmark.py` with number_of_threads being 8.
    - Include and compare graphs generated by `python graph.py` by both MP1 and MP2. Which solution is better and why?
    - In the `parallel_acc_wrapper` function, explain the correct  of the order of operations with respect to acquiring the lock and call `acc_file`. Does the order matter? Will the order affect the speed of execution?
    - You are writing a program that contains three threads.  The following threads are labled *S1*, *S2*, *S3* and use the locking method shown below. Do you see a potential problem? If there is a problem, define the problem and describe it.
     
    ![HomeworkProblem](./images/Problem2.5.4.png?raw=true)



